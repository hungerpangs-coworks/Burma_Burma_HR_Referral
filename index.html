<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Burma Burma | Employee Referral Portal</title>

  <!-- Basic SEO -->
  <meta name="description"
        content="Submit employee referrals for Burma Burma Restaurant & Tea Room through a simple HR referral portal integrated with Google Sheets." />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="robots" content="index, follow" />

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="BB_Logo_favicon.png" />

  <!-- Social / Open Graph -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Burma Burma | Employee Referral Portal" />
  <meta property="og:description"
        content="A quick and easy way for Burma Burma employees to submit referrals directly to HR." />
  <meta property="og:url"
        content="https://hungerpangs-coworks.github.io/Burma_Burma_HR_Referral/" />
  <meta property="og:image"
        content="https://hungerpangs-coworks.github.io/Burma_Burma_HR_Referral/BB_Logo_favicon.png" />

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Burma Burma | Employee Referral Portal" />
  <meta name="twitter:description"
        content="Submit employee referrals quickly with this internal HR portal." />
  <meta name="twitter:image"
        content="https://hungerpangs-coworks.github.io/Burma_Burma_HR_Referral/BB_Logo_favicon.png" />

  <style>
    :root {
      --bb-primary: #2b5dff;
      --bb-primary-dark: #2349cc;
      --bb-bg: #f4f7ff;
      --bb-border: #d0d7e2;
      --bb-text-main: #222;
      --bb-text-muted: #666;
      --bb-radius-lg: 24px;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #f0f5ff 0, #f8fbff 45%, #f5f7fb 100%);
      margin: 0;
      padding: 32px 12px 40px;
      color: var(--bb-text-main);
    }

    .shell {
      max-width: 1024px;
      margin: 0 auto;
    }

    .hero {
      text-align: center;
      margin-bottom: 24px;
    }

    .hero-logo {
      width: 96px;
      height: 96px;
      border-radius: 999px;
      object-fit: contain;
      margin-bottom: 8px;
    }

    .hero-title {
      margin: 4px 0;
      font-size: 28px;
      font-weight: 700;
      letter-spacing: 0.04em;
      color: #1550c9;
    }

    .hero-sub {
      margin: 0;
      font-size: 14px;
      color: var(--bb-text-muted);
    }

    .page {
      background: #fff;
      border-radius: var(--bb-radius-lg);
      padding: 28px 28px 24px;
      box-shadow:
        0 18px 45px rgba(15, 35, 96, 0.18),
        0 0 0 1px rgba(210, 220, 240, 0.8);
    }

    .section-title {
      font-weight: 600;
      margin: 10px 0 6px;
      font-size: 13px;
      text-transform: none;
      letter-spacing: 0.06em;
      color: #5b647b;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 16px 18px;
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    label {
      font-size: 13px;
      font-weight: 500;
      color: #444;
    }

    input[type="text"],
    textarea,
    select {
      border-radius: 999px;
      border: 1px solid var(--bb-border);
      padding: 10px 14px;
      font-size: 14px;
      outline: none;
      transition: border 0.15s, box-shadow 0.15s, background 0.15s;
      background: #f9fafc;
    }

    textarea {
      border-radius: 16px;
      min-height: 70px;
      resize: vertical;
    }

    input[type="file"] {
      font-size: 13px;
    }

    input[type="text"]:focus,
    textarea:focus,
    select:focus {
      border-color: var(--bb-primary);
      background: #ffffff;
      box-shadow: 0 0 0 2px rgba(43,93,255,0.12);
    }

    .actions {
      margin-top: 24px;
      display: flex;
      justify-content: space-between;
      gap: 12px;
      align-items: center;
      flex-wrap: wrap;
    }

    button {
      border-radius: 999px;
      border: none;
      padding: 10px 26px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      background: linear-gradient(135deg, #2b5dff, #19c3ff);
      color: #fff;
      box-shadow: 0 10px 24px rgba(43,93,255,0.45);
      transition: transform 0.1s, box-shadow 0.1s, filter 0.1s;
    }

    button:hover {
      transform: translateY(-1px);
      box-shadow: 0 14px 30px rgba(43,93,255,0.55);
      filter: brightness(1.03);
    }

    button:disabled {
      opacity: 0.6;
      cursor: default;
      transform: none;
      box-shadow: none;
      filter: none;
    }

    .status {
      font-size: 13px;
      color: #555;
      min-height: 18px;
    }
    .status.error {
      color: #c0392b;
    }
    .status.success {
      color: #1e8449;
    }

    .required {
      color: #c0392b;
      margin-left: 2px;
    }

    @media (max-width: 600px) {
      body {
        padding: 20px 10px 28px;
      }
      .page {
        padding: 20px 16px 18px;
      }
      .hero-title {
        font-size: 22px;
      }
    }
  </style>
</head>

<body>
  <div class="shell">
    <header class="hero">
      <!-- Upload a larger logo as BB_Logo_header.png if you like -->
      <img src="BB_Logo_favicon.png" alt="Burma Burma" class="hero-logo" />
      <h1 class="hero-title">Employee Referral</h1>
      <p class="hero-sub">Refer great talent to the Burma Burma family in just a few clicks.</p>
    </header>

    <div class="page">
      <!-- Section 1: Your core details -->
      <div class="section-title">Your details</div>
      <div class="grid">
        <div class="field">
          <label>Employee ID <span class="required">*</span></label>
          <input type="text" id="employeeId" placeholder="Enter your employee ID" />
        </div>
        <div class="field">
          <label>Employee Name <span class="required">*</span></label>
          <input type="text" id="employeeName" placeholder="Enter your full name" />
        </div>
        <div class="field">
          <label>Outlet Name <span class="required">*</span></label>
          <select id="outletName">
            <option value="">Select outlet</option>
          </select>
        </div>
      </div>

      <!-- Section 2: Referral details (above department/designation) -->
      <div class="section-title" style="margin-top:18px;">Referral details</div>
      <div class="grid">
        <div class="field">
          <label>Upload CV (PDF / DOC)</label>
          <input type="file" id="cvFile" accept=".pdf,.doc,.docx,.rtf,.txt" />
        </div>
        <div class="field" style="grid-column: 1 / -1;">
          <label>Any remarks</label>
          <textarea id="remarks" placeholder="Share anything helpful about the person youâ€™re referring (optional)"></textarea>
        </div>
      </div>

      <!-- Section 3: Your position -->
      <div class="section-title" style="margin-top:18px;">Your position</div>
      <div class="grid">
        <div class="field">
          <label>Your Department <span class="required">*</span></label>
          <select id="refDept">
            <option value="">Select department</option>
          </select>
        </div>
        <div class="field">
          <label>Your Designation <span class="required">*</span></label>
          <select id="refDesig">
            <option value="">Select designation</option>
          </select>
        </div>
      </div>

      <div class="actions">
        <div class="status" id="statusText"></div>
        <button id="submitBtn">Submit Referral</button>
      </div>
    </div>
  </div>

  <script>
    // ðŸ”´ Your web app URL
    const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbxIiJkv_m0RA3NnrI6uSiJzoy0GLLA1CX5RLauOnoq2fqSwsIKu_UXEPydrnC3cd6DuYg/exec';

    const outletSelect = document.getElementById('outletName');
    const deptSelect   = document.getElementById('refDept');
    const desigSelect  = document.getElementById('refDesig');
    const statusText   = document.getElementById('statusText');
    const submitBtn    = document.getElementById('submitBtn');

    let deptDesigMap = {}; // dept -> [designations]

    function setStatus(msg, type) {
      statusText.textContent = msg || '';
      statusText.className = 'status' + (type ? ' ' + type : '');
    }

    function fillSelect(selectEl, items, placeholder) {
      selectEl.innerHTML = '';
      const opt0 = document.createElement('option');
      opt0.value = '';
      opt0.textContent = placeholder;
      selectEl.appendChild(opt0);

      (items || []).forEach(v => {
        const opt = document.createElement('option');
        opt.value = v;
        opt.textContent = v;
        selectEl.appendChild(opt);
      });
    }

    function updateDesignationOptionsForDept(dept) {
      const list = deptDesigMap[dept] || [];
      fillSelect(desigSelect, list, 'Select designation');
    }

    async function loadConfig() {
      try {
        setStatus('Loading options...', '');
        const res = await fetch(WEB_APP_URL + '?action=getConfig');
        const data = await res.json();
        if (!data.success) throw new Error(data.error || 'Failed to load config');

        const { outlets, departments, deptDesigMap: ddm } = data.data || {};
        deptDesigMap = ddm || {};

        fillSelect(outletSelect, outlets, 'Select outlet');
        fillSelect(deptSelect, departments, 'Select department');
        fillSelect(desigSelect, [], 'Select designation');

        setStatus('', '');
      } catch (err) {
        console.error(err);
        setStatus('Error loading options: ' + err.message, 'error');
      }
    }

    deptSelect.addEventListener('change', () => {
      const dept = deptSelect.value.trim();
      updateDesignationOptionsForDept(dept);
      desigSelect.value = '';
    });

    function fileToBase64(file) {
      return new Promise((resolve, reject) => {
        if (!file) return resolve(null);
        const reader = new FileReader();
        reader.onload = () => {
          const result = reader.result || '';
          const parts = String(result).split(',');
          resolve(parts.length > 1 ? parts[1] : null);
        };
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }

    async function handleSubmit() {
      try {
        setStatus('', '');
        submitBtn.disabled = true;
        submitBtn.textContent = 'Submitting...';

        const employeeId   = document.getElementById('employeeId').value.trim();
        const employeeName = document.getElementById('employeeName').value.trim();
        const outletName   = outletSelect.value.trim();
        const referringDept = deptSelect.value.trim();
        const referringDesig = desigSelect.value.trim();
        const remarks      = document.getElementById('remarks').value.trim();
        const cvFile       = document.getElementById('cvFile').files[0] || null;

        if (!employeeId || !employeeName || !outletName || !referringDept || !referringDesig) {
          throw new Error('Please fill all required fields (*)');
        }

        const base64 = await fileToBase64(cvFile);
        const cvPayload = base64 ? {
          fileName: cvFile.name,
          mimeType: cvFile.type || 'application/octet-stream',
          base64: base64
        } : null;

        const payload = {
          employeeId,
          employeeName,
          outletName,
          referringDept,
          referringDesignation: referringDesig,
          remarks,
          cv: cvPayload
        };

        // Use FormData â†’ avoids CORS preflight issues
        const formData = new FormData();
        formData.append('payload', JSON.stringify({
          action: 'submitReferral',
          payload
        }));

        const res = await fetch(WEB_APP_URL, {
          method: 'POST',
          body: formData
        });

        const data = await res.json();
        if (!data.success) throw new Error(data.error || 'Failed to submit');

        setStatus('Referral submitted successfully ðŸŽ‰', 'success');

        // Clear fields
        document.getElementById('employeeId').value = '';
        document.getElementById('employeeName').value = '';
        outletSelect.value = '';
        deptSelect.value = '';
        updateDesignationOptionsForDept('');
        document.getElementById('remarks').value = '';
        document.getElementById('cvFile').value = '';

      } catch (err) {
        console.error(err);
        setStatus(err.message || 'Something went wrong', 'error');
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'Submit Referral';
      }
    }

    submitBtn.addEventListener('click', evt => {
      evt.preventDefault();
      handleSubmit();
    });

    // Initial load
    loadConfig();
  </script>
</body>
</html>
